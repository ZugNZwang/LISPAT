  1   CSCI3761      Lab #1                   Spring 2019 Due: February, 27 (Wednesday), 2019 Max points: 30 points  Objective  1. Learn how to use packet sniffing tool, Wireshark 2. Learn the main protocol of DNS (Domain Name Services)    Note: This lab is adapted from DNS WireShark Lab, “Computer Networking: A Top-Down Approach”, 7th ed, J.F. Kurose and K.W. Ross.  Required software tool  1. Packet Sniffer  The purpose of lab assignments is to show how we can get a deeper understanding of the networking concepts by capturing and analyzing the packets sent and received from our host. One way to do so is to use a packet sniffer. A packet sniffer is a piece of soft- ware that should be running in parallel with the application whose packets needed to be analyzed. However, before running a packet sniffer, we need to interpret the term packet. As we discussed in Chapter 1 of the textbook, communication via the Internet is done using a five-layer suite. We can analyze the packets at four layers: application, transport, network, and data-link. There is no packet exchange at the physical layer; communication at this layer is done using bits.  In an outgoing situation, a packet created at any upper-layer is encapsulated in a frame (at the data-link layer); in an incoming situation, a packet intended for any layer is decapsulated from the received frame. This means we need to capture only outgoing or incoming frames; a packet-sniffer software can extract the packets at any layer desired to be analyzed from these frames. For this reason, a packet-sniffer software is normally has two components: a packet-capturer and a packet-analyzer. The packet-capturer captures a copy of all outgoing and incoming frames (at the data-link layer) and passes them to the packet-analyzer. The packet- analyzer can then extract different headers and the ultimate message for analysis.  2. Wireshark  In this and other lab assignments, we use a packet-sniffer called Wireshark. Wireshark (formerly known as ETHEREAL) is a free packet sniffer/analyzer which is available for  2  both UNIX-like (Unix, Linux, Mac OS X, BSD, and Solaris) and Windows operating systems. It captures packets from a network interface and displays them with detailed protocol information. Wireshark, however, is a passive analyzer. It only captures packets without manipulate them; it neither sends packets to the network nor does other active operations. Wireshark is not an intrusion-detection tool either. It does not give warning about any network intrusion. It, nevertheless, can help network administrators to figure out what is going on inside a network and to troubleshoot network problems. In addition of being an indispensable tool for network administrators, Wire- shark is a valuable tool for protocol developers, who may use it to debug protocol implementations. It is also a great educational tool for computer-network students who can use it to see details of protocol operations in real time.  2.1 Downloading and Installing To download the Wireshark software, connect to the Internet using the website:  http://www.wireshark.org/download.html  After the downloading is complete, install the software on your computer. If you have any problem in downloading or installing, you can consult the following site for more information:  http://wiki.wireshark.org/CaptureSetup 2.2 Main Window  The Wireshark main window is similar to other GUI tools as shown in Figure 2.1. The Wireshark window is made of seven sections: title bar, menu bar, filter bar, packet list pane, packet detail pane, packet byte pane, and status bar. We briefly discuss the functionality of each section below:  Title Bar The title bar (like the one in any GUI) shows the title of the window, the closing, maximizing, and minimizing icons.  Menu Bar The menu bar is made of several pulldown menus and tool bars used in most GUIs. We will using some of these menus in our lab assignments. We can use the File menu to perform some actions on the file itself such as saving and printing. The Capture menu is used to start and capturing frames. The View menu is useful to show or hide some of the sections in the window.     3  Filter Bar  The filter bar allows us to display packet we are interested in while hiding the rest. As we see later in this document, when we start capturing frames, Wireshark captures and analyze any outgoing and incoming frame no matter what is the source or sink proto- col. Sometimes, this is not what we want. We may want to limit the analysis to a specific source or sink protocol. For example, we may want to analyze only packets sent or receive by the HTTP protocol at the application layer or the ARP protocol at the net- work layer. This is called filtering in the parlance of packet sniffing. After packets have been captured, we can type the name of the protocol in lowercase and click Apply.   Figure 2.1   Main window of Wireshark                                                                                                                                                         Packet byte pane Status Bar Packet list pane Packet detail pane   Filter bar Menu toolbar Title bar  4    Packet List Pane The packet list pane displays a one-line summary for each captured packet (actually frame). The summary includes the packet (frame) number (added by the Wireshark and not part of the packet), the time when the packet was captured, the source and destination IP addresses of the packet (at the network layer), the packet source or sink proto- col, and the additional information about the packet contents. In other words, this pane shows the captured frames that will be passed for analyzing to the packet analyzer.  Packet Detail Pane The packet detail pane shows the detailed analysis for each frame (Figure 2.2).  The information is limited to one frame, which means we need to select one of the frames in the packet list pane for analysis. This can be done by clicking on the corresponding frame in the packet list pane. Clicking on any frame in the packet list pane highlights the frame and shows the details of the frame in the packet details pane. Information exhibited in this pane for each frame is made of a tree structure. However, each top branch of the tree is shown as one line as it is common in GUI trees. We can expand the branch (to see subbranches) by clicking on the plus box at the leftmost part of the line, which changes the plus sign to a minus sign; the branch can be collapsed again, which changes the minus sign to the plus sign. Note that the analyzer first shows a general information at the data-link layer (frame). It then displays the information contained in each header from the data-link layer (H2) up to the source or sink protocol. It finally shows the whole message at the source or sink layer. Figure 2.2 shows an example of a packet details pane when the frame is expanded. It shows some general information and names of all protocols used in the frame (intermediate and source or sink).             5                                    Figure 2.2   Packet detail pane     Packet byte pane The packet byte pane shows the entire current frame (selected in the packet list pane) in hexdump format (hexadecimal view of data) and ASCII format. The number in the left field shows the offset in the packet data; the hexdump of the packet is shown in the middle field; the corresponding ASCII characters are shown in the right field. If we need the byte (or ASCII equivalent) of any line in the packet detail pane, we can click on the line in the packet detail pane and the byte contents will be highlighted. Figure 2.3 shows an example of a packet byte pane. It shows all the bytes in the frame, but we can select the bytes in any protocol header by highlighting it in the packet detail pane section.           6                         Figure 2.3   Packet byte pane       Status Bar The last section of the window (at the bottom) is the status bar which shows the current protocol, the total number of packets captured, and so on.  2.3    Working With Wireshark  When we work with Wireshark in this and other labs, there are some actions that we need to repeat over and over. We mention the details of some of this action to avoid re- mentioning them.  Start Capturing To begin capturing, select the Capture from the pull down menu and click Options to open the Wireshark capture options dialog box (Figure 2.5).    7     Figure 2.5   Caption options dialog box                           There are several steps that you need to follow before you start capturing:  ■   You normally will use the default values in the capture options dialog box, but there are some options that you may need to override the default. In particular, you may want to uncheck “Hide capture info dialog.” and open capture information window (Figure 2.6). ■   The network interfaces are shown in the Interface drop-down list at the top of the dialog box. Select the network interface (or use the default interface chosen by Wireshark). If the IP address in the dialog box is unknown, you must select a different interface; otherwise, the Wireshark will not capture any packet    8         Figure 2.6   Capture information dialog      . ■   After the above two steps, click Start. Wireshark starts to captures packets that are exchanged between your computer and the network. If, after a minute, Wireshark does not capture any packet, there must be a problem; check for possible reason and troubleshooting.  Stop Capturing Whenever you feel you have captured all the packets (frames) that you need to do your lab report, you can stop capturing. To do so, you need to use the Capture pulldown menu and click Stop. Wireshark stops capturing the frames  Saving the Captured File After you have stopped capturing, you may want to save the captured file for future use.  9  2.4  Incoming and Outgoing Frames  When we see the list of the captured frames, we often wonder which frames are the incoming and which ones are outgoing. This can be found by looking at the frame in packet list pane. The packet list pane shows the source and destination addresses of the frame (generated and inserted at the network layer). If the source address is the address of the host you are working with (shown on the Capture window when you start capturing), the frame is the outgoing frame; if the destination address is the address of your host, and the frame is the incoming frame.  2.5 Lab-Report Sheets To make the report of your observation in each chapter easier and consistent, we have created lab report sheets for each lab assignment. Each chapter has as many lab report sheets as the number of lab assignments for that chapter. Each lab report sheet has been prepared as a Word documents to let the student fill up and turn in.  2.6 Printing the Captured Information As a supporting document for each lab assignment, you need to turn in a printout of the captured information. You can do this by selecting the packet and expanding it in the packet detailed pane, selecting Print from the File menu, selecting the necessary printing options in the Wireshark print window, and finally clicking the Print button.                    10  3. LAB1 : DNS  + Wireshark The lab assignment for this chapter is a warm-up testing of the Wireshark software. In this lab, we retrieve a web page and then, using Wireshark, capture packets.  There are several network administration tools for Microsoft Windows and UNIX-like operating systems that are useful for network troubleshooting as well as for educational purposes. Among these tools are the following: ■ dig (Domain Information Groper) is used for querying DNS servers. This utility replaces older tools such as nslookup. ■ ipconfig (Internet Protocol Configuration) for Windows or ifconfig (Interface Configuration) for UNIX-like operating systems is used to configure, control, and query TCP/IP network interface parameters.  3.1 Assignment This lab is made of three parts. In Part I, we use the nslookup. In Part II, we use ipcon- fig utility. Finally, in Part III, we use Wireshark to find more information about the packets exchanged by the DNS protocol. Pick an educational institute outside of the state of Colorado, and use its Hostname or IP address when you run “dig” using both CLI based and Web based.  3.1 nslookup In this lab, we’ll make extensive use of the nslookup tool, which is available in most Linux/Unix and Microsoft platforms today. To run nslookup in Linux/Unix, you just type the nslookup command on the command line. To run it in Windows, open the Command Prompt and run nslookup on the command line.  In it is most basic operation, nslookup tool allows the host running the tool to query any specified DNS server for a DNS record. The queried DNS server can be a root DNS server, a top-level-domain DNS server, an authoritative DNS server, or an intermediate DNS server (see the textbook for definitions of these terms). To accomplish this task, nslookup sends a DNS query to the specified DNS server, receives a DNS reply from that same DNS server, and displays the result.   11   The above screenshot shows the results of three independent nslookup commands (displayed in the Windows Command Prompt). In this example, the client host is located on the campus of Polytechnic University in Brooklyn, where the default local DNS server is dns-prime.poly.edu. When running nslookup, if no DNS server is specified, then nslookup sends the query to the default DNS server, which in this case is dns-prime.poly.edu. Consider the first command: nslookup www.mit.edu In words, this command is saying “please send me the IP address for the host www.mit.edu”. As shown in the screenshot, the response from this command provides two pieces of information: (1) the name and IP address of the DNS server that provides the answer; and (2) the answer itself, which is the host name and IP address of www.mit.edu. Although the response came from the local DNS server at Polytechnic University, it is quite possible that this local DNS server iteratively    12  contacted several other DNS servers to get the answer, as described in Section 4.17 of the textbook.  Now consider the second command: nslookup –type=NS mit.edu In this example, we have provided the option “-type=NS” and the domain “mit.edu”. This causes nslookup to send a query for a type-NS record to the default local DNS server. In words, the query is saying, “please send me the host names of the authoritative DNS for mit.edu”. (When the –type option is not used, nslookup uses the default, which is to query for type A records.) The answer, displayed in the above screenshot, first indicates the DNS server that is providing the answer (which is the default local DNS server) along with three MIT nameservers. Each of these servers is indeed an authoritative DNS server for the hosts on the MIT campus. However, nslookup also indicates that the answer is “non-authoritative,” meaning that this answer came from the cache of some server rather than from an authoritative MIT DNS server. Finally, the answer also includes the IP addresses of the authoritative DNS servers at MIT. (Even though the type-NS query generated by nslookup did not explicitly ask for the IP addresses, the local DNS server returned these “for free” and nslookup displays the result.) Now finally consider the third command: nslookup www.snu.ac.kr google-piblic-dns-a.google.com In this example, we indicate that we want to the query sent to the DNS server bitsy.mit.edu rather than to the default DNS server (dns-prime.poly.edu). Thus, the query and reply transaction takes place directly between our querying host and bitsy.mit.edu. In this example, the DNS server bitsy.mit.edu provides the IP address of the host www.aiit.or.kr, which is a web server at the Advanced Institute of Information Technology (in Korea).  Now that we have gone through a few illustrative examples, you are perhaps wondering about the general syntax of nslookup commands. The syntax is:  13  nslookup –option1 –option2 host-to-find dns-server In general, nslookup can be run with zero, one, two or more options. And as we have seen in the above examples, the dns-server is optional as well; if it is not supplied, the query is sent to the default local DNS server.  Now that we have provided an overview of nslookup, it is time for you to test drive it yourself.  Questions (Do the following (and write down the results)):  1. Run nslookup to obtain the IP address of a Web server in Asia. What is the IP address of that server? 2. Run nslookup to determine the authoritative DNS servers for a university in Europe. 3. Run nslookup so that one of the DNS servers obtained in Question 2 is queried for the mail servers for Yahoo! mail.   What is its IP address?  3.2  Using ipconfig  ipconfig (for Windows) and ifconfig (for Linux/Unix) are among the most useful little utilities in your host, especially for debugging network issues. Here we’ll only describe ipconfig, although the Linux/Unix ifconfig is very similar. ipconfig can be used to show your current TCP/IP information, including your address, DNS server addresses, adapter type and so on. For example, if you all this information about your host simply by entering  ipconfig \all into the Command Prompt, as shown in the following screenshot.    14   ipconfig is also very useful for managing the DNS information stored in your host. In Section 4.17 we learned that a host can cache DNS records it recently obtained. To see these cached records, after the prompt C:\> provide the following command: ipconfig /displaydns Each entry shows the remaining Time to Live (TTL) in seconds. To clear the cache, enter ipconfig /flushdns Flushing the DNS cache clears all entries and reloads the entries from the hosts file.    15  Tracing DNS with Wireshark Now that we are familiar with nslookup and ipconfig, we’re ready to get down to some serious business. Let’s first capture the DNS packets that are generated by ordinary Web-surfing activity. • Use ipconfig to empty the DNS cache in your host. • Open your browser and empty your browser cache. (With Internet Explorer, go to Tools menu and select Internet Options; then in the General tab select Delete Files.) • Open Wireshark and enter “ip.addr == your_IP_address” into the filter, where you obtain your_IP_address with ipconfig. This filter removes all packets that neither originate nor are destined to your host.  • Start packet capture in Wireshark. • With your browser, visit the Web page: http://www.ietf.org  • Stop packet capture.   Answer the following questions. Whenever possible, when answering a question below, you should hand in a printout of the packet(s) within the trace that you used to answer the question asked.  Annotate the printout1 to explain your answer. To print a packet, use File->Print, choose Selected packet only, choose Packet summary line, and select the minimum amount of packet detail that you need to answer the question. Questions Using the result of running ipconfig, answer the following question in your lab report.  4. Locate the DNS query and response messages. Are then sent over UDP or TCP?  5. What is the destination port for the DNS query message? What is the source port of DNS response message?                                                            1 What do we mean by “annotate”?  If you hand in a paper copy, please highlight where in the printout you’ve found the answer and add some text (preferably with a colored pen) noting what you found in what you ‘ve highlight.  If you hand in an electronic copy, it would be great if you could also highlight and annotate.    16  6. To what IP address is the DNS query message sent? Use ipconfig to determine the IP address of your local DNS server. Are these two IP addresses the same?  7. Examine the DNS query message. What “Type” of DNS query is it? Does the query message contain any “answers”? 8. Examine the DNS response message. How many “answers” are provided? What do each of these answers contain? 9. Consider the subsequent TCP SYN packet sent by your host. Does the destination  IP address of the SYN packet correspond to any of the IP addresses provided in the DNS response message? 10. This web page contains images. Before retrieving each image, does your host issue new DNS queries?                            17  3,.3 Using Wireshark to Capture DNS Packets  Now let’s play with nslookup. • Start packet capture.  • Do an nslookup on www.mit.edu • Stop packet capture.    You should get a trace that looks something like the following:  We see from the above screenshot that nslookup actually sent three DNS queries and    18  received three DNS responses. For the purpose of this assignment, in answering the following questions, ignore the first two sets of queries/responses, as they are specific to nslookup and are not normally generated by standard Internet applications. You should instead focus on the last query and response messages. Questions  11. What is the destination port for the DNS query message? What is the source port of DNS response message? 12. To what IP address is the DNS query message sent? Is this the IP address of your default local DNS server? 13. Examine the DNS query message. What “Type” of DNS query is it? Does the query message contain any “answers”? 14. Examine the DNS response message. How many “answers” are provided? What do each of these answers contain? 15. Provide a screenshot.  Now repeat the previous experiment, but instead issue the command: nslookup –type=NS mit.edu Questions  16. To what IP address is the DNS query message sent? Is this the IP address of your default local DNS server? 17. Examine the DNS query message. What “Type” of DNS query is it? Does the query message contain any “answers”? 18. Examine the DNS response message. What MIT nameservers does the response message provide? Does this response message also provide the IP addresses of the MIT namesers? 19. Provide a screenshot.    19  Now repeat the previous experiment, but instead issue the command: nslookup www.snu.ac.kr google-public-dns-a.google.com Answer the following questions: 20. To what IP address is the DNS query message sent? Is this the IP address of your default local DNS server? If not, what does the IP address correspond to? 21. Examine the DNS query message. What “Type” of DNS query is it? Does the query message contain any “answers”? 22. Examine the DNS response message. How many “answers” are provided? What does each of these answers contain? 23. Provide a screenshot.  4. Documents to Turn in  Turn in the following documents:  A hard copy of the Lab1-DNS report sheet that contains answered questions and the screen captures of all three parts for your answers.      